[gd_scene load_steps=23 format=4 uid="uid://b4iayybapkwb3"]

[ext_resource type="Script" uid="uid://bgispvho0cwmg" path="res://levels/test_world.gd" id="1_sscd3"]
[ext_resource type="Script" uid="uid://b5t80hbipjcoh" path="res://levels/character_manager.gd" id="2_2hlnk"]
[ext_resource type="PackedScene" uid="uid://c2gvyh0qsi420" path="res://menus/game_end_screen/summary_screen.tscn" id="3_aoxel"]
[ext_resource type="PackedScene" uid="uid://b1qse64s6bngg" path="res://menus/UI/interact_prompt.tscn" id="4_e1yux"]
[ext_resource type="Script" uid="uid://l81xuudo3eax" path="res://levels/objectives_manager.gd" id="4_nmfs6"]
[ext_resource type="Script" uid="uid://dxotka5rmdqtd" path="res://addons/func_godot/src/map/func_godot_map.gd" id="5_aoxel"]
[ext_resource type="Resource" uid="uid://bkhxcqsquw1yg" path="res://addons/func_godot/func_godot_default_map_settings.tres" id="6_nmfs6"]
[ext_resource type="Script" uid="uid://cwseu8wfeb2ym" path="res://levels/level_filter.gd" id="7_cfxsv"]
[ext_resource type="Material" uid="uid://dlcrtv1drot2v" path="res://levels/tunnels/materials/killer.tres" id="8_ys8da"]
[ext_resource type="Material" uid="uid://dao77be232b10" path="res://characters/survivor_shader.tres" id="9_mix7n"]
[ext_resource type="Texture2D" uid="uid://cyg2snr1w5xw5" path="res://addons/func_godot/textures/default_texture.png" id="10_bgxd0"]
[ext_resource type="Script" uid="uid://byfu7xg2wqjyl" path="res://level_objects/spawns/player_spawn.gd" id="11_x7c7k"]
[ext_resource type="Script" uid="uid://bveiglrvr42w7" path="res://level_objects/lights/tb_omnilight.gd" id="13_cfxsv"]
[ext_resource type="Script" uid="uid://ddsre2ypfh4ik" path="res://level_objects/lights/flashing_light.gd" id="14_ys8da"]

[sub_resource type="WorldBoundaryShape3D" id="WorldBoundaryShape3D_sscd3"]

[sub_resource type="Gradient" id="Gradient_2hlnk"]

[sub_resource type="FastNoiseLite" id="FastNoiseLite_aoxel"]

[sub_resource type="NoiseTexture2D" id="NoiseTexture2D_nmfs6"]
color_ramp = SubResource("Gradient_2hlnk")
noise = SubResource("FastNoiseLite_aoxel")

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_n0j0v"]
albedo_texture = SubResource("NoiseTexture2D_nmfs6")

[sub_resource type="PlaneMesh" id="PlaneMesh_jnby3"]
material = SubResource("StandardMaterial3D_n0j0v")
size = Vector2(50, 50)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_ys8da"]
albedo_texture = ExtResource("10_bgxd0")
metallic_specular = 0.0
texture_filter = 2

[sub_resource type="ArrayMesh" id="ArrayMesh_mix7n"]
_surfaces = [{
"aabb": AABB(-2, -0.5, -2, 4, 1, 4),
"attribute_data": PackedByteArray("AACAPwAAgL4AAIA/AACAPgAAgL8AAIA+AACAvwAAgL4AAIC/AACAvgAAgD8AAIC+AACAPwAAgD4AAIC/AACAPgAAgD8AAIC/AACAPwAAgD8AAIC/AACAPwAAgL8AAIC/AACAvwAAgL8AAIA/AACAvwAAgD8AAIA/AACAvwAAgD8AAIA/AACAvgAAgD8AAIA+AACAvwAAgD4AAIC/AACAvgAAgL8AAIC+AACAPwAAgL4AAIA/AACAPgAAgL8AAIA+"),
"format": 34359742487,
"index_count": 36,
"index_data": PackedByteArray("AAABAAIAAAACAAMABAAFAAYABAAGAAcACAAJAAoACAAKAAsADAANAA4ADAAOAA8AEAARABIAEAASABMAFAAVABYAFAAWABcA"),
"material": SubResource("StandardMaterial3D_ys8da"),
"name": "__TB_empty",
"primitive": 3,
"uv_scale": Vector4(0, 0, 0, 0),
"vertex_count": 24,
"vertex_data": PackedByteArray("AAAAwAAAAD8AAADAAAAAwAAAAL8AAADAAAAAQAAAAL8AAADAAAAAQAAAAD8AAADAAAAAwAAAAD8AAADAAAAAwAAAAD8AAABAAAAAwAAAAL8AAABAAAAAwAAAAL8AAADAAAAAQAAAAL8AAADAAAAAwAAAAL8AAADAAAAAwAAAAL8AAABAAAAAQAAAAL8AAABAAAAAQAAAAD8AAADAAAAAQAAAAD8AAABAAAAAwAAAAD8AAABAAAAAwAAAAD8AAADAAAAAQAAAAD8AAADAAAAAQAAAAL8AAADAAAAAQAAAAL8AAABAAAAAQAAAAD8AAABAAAAAwAAAAD8AAABAAAAAQAAAAD8AAABAAAAAQAAAAL8AAABAAAAAwAAAAL8AAABA/////wAA/7//////AAD/v/////8AAP+//////wAA/78AAP9//3//vwAA/3//f/+/AAD/f/9//78AAP9//3//v/9/AAD//////38AAP//////fwAA//////9/AAD//////3////9//7//f////3//v/9/////f/+//3////9//7////9//////////3//////////f/////////9///////9//3////+//3//f////7//f/9/////v/9//3////+/")
}]

[node name="LevelTemplate" type="Node3D" node_paths=PackedStringArray("char_man")]
script = ExtResource("1_sscd3")
char_man = NodePath("CharacterManager")
metadata/_custom_type_script = "uid://bgispvho0cwmg"

[node name="CharacterManager" type="Node3D" parent="." node_paths=PackedStringArray("spawn_parent")]
script = ExtResource("2_2hlnk")
spawn_parent = NodePath("../CanvasLayer/SubViewportContainer/SubViewport/PlayerHolder")

[node name="MultiplayerSpawner" type="MultiplayerSpawner" parent="CharacterManager"]
_spawnable_scenes = PackedStringArray("uid://hhg2l8rjh56j", "uid://dvquo8dq47kay", "uid://3fqhr5mt0oju")
spawn_path = NodePath("../../CanvasLayer/SubViewportContainer/SubViewport/PlayerHolder")

[node name="CanvasLayer" type="CanvasLayer" parent="."]

[node name="SubViewportContainer" type="SubViewportContainer" parent="CanvasLayer"]
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
stretch = true
script = ExtResource("7_cfxsv")
killer = ExtResource("8_ys8da")
survivor = ExtResource("9_mix7n")

[node name="SubViewport" type="SubViewport" parent="CanvasLayer/SubViewportContainer"]
handle_input_locally = false
size = Vector2i(1152, 648)
render_target_update_mode = 4

[node name="PlayerHolder" type="Node3D" parent="CanvasLayer/SubViewportContainer/SubViewport"]

[node name="SummaryScreen" parent="CanvasLayer" instance=ExtResource("3_aoxel")]
unique_name_in_owner = true
visible = false

[node name="InteractPrompt" parent="CanvasLayer" instance=ExtResource("4_e1yux")]

[node name="ObjectivesManager" type="Node" parent="." groups=["objective_manager"]]
script = ExtResource("4_nmfs6")

[node name="Floor" type="StaticBody3D" parent="."]

[node name="CollisionShape3D" type="CollisionShape3D" parent="Floor"]
shape = SubResource("WorldBoundaryShape3D_sscd3")

[node name="MeshInstance3D" type="MeshInstance3D" parent="Floor"]
mesh = SubResource("PlaneMesh_jnby3")

[node name="LevelObjects" type="Node3D" parent="."]

[node name="FuncGodotMap" type="Node3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -0.00492954, 0.00931334, -9.48906e-05)
script = ExtResource("5_aoxel")
local_map_file = "uid://bahn2x3oimc3t"
map_settings = ExtResource("6_nmfs6")
metadata/_custom_type_script = "uid://dxotka5rmdqtd"

[node name="entity_0_worldspawn" type="Node3D" parent="FuncGodotMap"]

[node name="entity_0_mesh_instance" type="MeshInstance3D" parent="FuncGodotMap/entity_0_worldspawn"]
cast_shadow = 2
gi_mode = 0
mesh = SubResource("ArrayMesh_mix7n")

[node name="entity_1_PlayerSpawn" type="Marker3D" parent="FuncGodotMap"]
transform = Transform3D(-1, 0, -8.74228e-08, 0, 1, 0, 8.74228e-08, 0, -1, 1, 1.5, 1.5)
script = ExtResource("11_x7c7k")
type = "killer"

[node name="entity_2_PlayerSpawn" type="Marker3D" parent="FuncGodotMap"]
transform = Transform3D(-1, 0, -8.74228e-08, 0, 1, 0, 8.74228e-08, 0, -1, -1, 1.5, -1)
script = ExtResource("11_x7c7k")

[node name="entity_3_Light_OmniLight3D" type="OmniLight3D" parent="FuncGodotMap"]
transform = Transform3D(-1, 0, -8.74228e-08, 0, 1, 0, 8.74228e-08, 0, -1, -3, 1, 0)
light_color = Color(0.0431373, 0.784314, 0.0941176, 1)
light_energy = 2.0
omni_range = 10.0
script = ExtResource("13_cfxsv")

[node name="entity_4_Light_Flashing" type="OmniLight3D" parent="FuncGodotMap"]
transform = Transform3D(-1, 0, -8.74228e-08, 0, 1, 0, 8.74228e-08, 0, -1, 4, 1, 0)
light_color = Color(0.784314, 0.784314, 0.784314, 1)
light_energy = 4.0
omni_range = 10.0
script = ExtResource("14_ys8da")

[node name="OmniLight3D" type="OmniLight3D" parent="."]

[connection signal="game_start" from="." to="CanvasLayer/SubViewportContainer" method="_on_world_game_start"]
[connection signal="all_dead" from="CharacterManager" to="." method="_on_character_manager_all_dead"]
[connection signal="survivors_win" from="ObjectivesManager" to="." method="_on_objectives_manager_survivors_win"]
